<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema Solar Interactivo</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            margin: 0;
            overflow: hidden; /* Prevent scrollbars */
            background-color: #000000; /* Deep space black */
            color: #ffffff;
            font-family: 'Inter', sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }
        #solarSystemCanvas {
            display: block;
            width: 100vw;
            height: 100vh;
            background: radial-gradient(ellipse at center, #1a1a2a 0%, #000010 70%, #000000 100%); /* Subtle space gradient */
        }
        #infoPanelContainer {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5); /* Dim overlay */
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }
        #infoPanelContainer.visible {
            opacity: 1;
            visibility: visible;
        }
        #infoPanel {
            background-color: rgba(10, 20, 40, 0.95); /* Dark blueish, semi-transparent */
            border: 1px solid #304070;
            border-radius: 12px; /* More rounded */
            padding: 25px;
            max-width: 90%;
            width: 650px; /* Increased width */
            max-height: 85vh;
            overflow-y: auto;
            box-shadow: 0 10px 30px rgba(0, 120, 255, 0.3); /* Glow effect */
            color: #e0e0ff; /* Light lavender text */
            position: relative; /* For close button positioning */
        }
        #infoPanel h2 {
            margin-top: 0;
            color: #80a0ff; /* Brighter blue for heading */
            font-size: 1.75rem; /* Larger title */
            border-bottom: 1px solid #304070;
            padding-bottom: 10px;
            margin-bottom: 15px;
        }
        #infoPanel p, #infoPanel li {
            line-height: 1.7; /* Increased line height */
            font-size: 1rem; /* Standard text size */
            margin-bottom: 10px;
        }
        #infoPanel strong {
            color: #a0c0ff; /* Highlight for strong text */
        }
        #infoMoonsList {
            list-style-type: disc;
            padding-left: 20px;
        }
        #infoMoonsList li { /* Style for clickable moon names in panel */
            cursor: pointer;
            color: #a0c0ff;
            transition: text-decoration 0.2s ease;
        }
        #infoMoonsList li:hover {
            text-decoration: underline;
        }
        #closeButton {
            position: absolute;
            top: 15px;
            right: 15px;
            background: transparent;
            border: none;
            color: #a0c0ff;
            font-size: 28px; /* Larger close button */
            cursor: pointer;
            transition: color 0.2s ease;
        }
        #closeButton:hover {
            color: #ffffff;
        }
        /* Custom scrollbar for info panel */
        #infoPanel::-webkit-scrollbar {
            width: 8px;
        }
        #infoPanel::-webkit-scrollbar-track {
            background: rgba(0,0,0,0.1);
            border-radius: 10px;
        }
        #infoPanel::-webkit-scrollbar-thumb {
            background: #304070;
            border-radius: 10px;
        }
        #infoPanel::-webkit-scrollbar-thumb:hover {
            background: #405080;
        }
    </style>
</head>
<body>
    <canvas id="solarSystemCanvas"></canvas>
    <div id="infoPanelContainer">
        <div id="infoPanel">
            <button id="closeButton" aria-label="Cerrar panel de información">&times;</button>
            <h2 id="infoName" class="text-2xl font-bold mb-2"></h2>
            <p id="infoText" class="text-sm"></p>
            <div id="infoMoonsContainer" class="mt-3" style="display:none;">
                <h3 id="infoMoonsTitle" class="text-lg font-semibold">Lunas:</h3>
                <ul id="infoMoonsList" class="list-disc pl-5 text-sm"></ul>
            </div>
        </div>
    </div>

    <script>
        // --- Global Constants ---
        const SPEED_MULTIPLIER = 16; 
        const HOVER_ZOOM_FACTOR = 1.5; 
        const HOVER_SLOWDOWN_FACTOR = 3; 

        const STAR_BASE_DISPLAY_RADIUS = 35;
        const PLANET_BASE_DISPLAY_RADIUS = 8;
        const MOON_BASE_DISPLAY_RADIUS = 3;

        const REAL_DAYS_PER_ANIM_SECOND_AT_1X = 2.5;

        // --- Canvas and Context ---
        const canvas = document.getElementById('solarSystemCanvas');
        const ctx = canvas.getContext('2d');
        let canvasWidth, canvasHeight;
        let centerX, centerY;
        let effectivePixelsPerAU;

        // --- Animation State ---
        let lastTime = 0;
        let solarSystemObjects = [];
        let hoveredObject = null;
        let originalSpeeds = new Map();
        let originalRadii = new Map();

        // --- DOM Elements for Info Panel ---
        const infoPanelContainer = document.getElementById('infoPanelContainer');
        const infoPanel = document.getElementById('infoPanel');
        const infoName = document.getElementById('infoName');
        const infoText = document.getElementById('infoText');
        const infoMoonsContainer = document.getElementById('infoMoonsContainer');
        const infoMoonsList = document.getElementById('infoMoonsList');
        const closeButton = document.getElementById('closeButton');

        // --- Celestial Data ---
        const celestialData = [
            {
                name: "Sol", type: "star", displaySizeFactor: 1, color: "#FFD700",
                orbitalRadiusAU: 0, orbitalPeriodDays: 0,
                info: "El Sol es la estrella en el centro de nuestro Sistema Solar. Es una esfera casi perfecta de plasma caliente, con un movimiento convectivo interno que genera un campo magnético a través de un proceso de dinamo. Es, con diferencia, la fuente de energía más importante para la vida en la Tierra.",
                moonsData: []
            },
            {
                name: "Mercurio", type: "planet", displaySizeFactor: 0.5, color: "#A9A9A9",
                orbitalRadiusAU: 0.39, orbitalPeriodDays: 88,
                info: "Mercurio es el planeta más pequeño del Sistema Solar y el más cercano al Sol. Su órbita tiene la mayor excentricidad y su eje la menor inclinación. Gira sobre su eje una vez cada 59 días terrestres. No tiene satélites naturales.",
                moonsData: []
            },
            {
                name: "Venus", type: "planet", displaySizeFactor: 0.9, color: "#E6E6FA",
                orbitalRadiusAU: 0.72, orbitalPeriodDays: 225,
                info: "Venus es el segundo planeta desde el Sol. A veces se le llama el 'planeta hermano' de la Tierra debido a su tamaño y masa similares. Tiene la atmósfera más densa de los cuatro planetas terrestres, compuesta principalmente de dióxido de carbono. No tiene satélites naturales.",
                moonsData: []
            },
            {
                name: "Tierra", type: "planet", displaySizeFactor: 1, color: "#6495ED",
                orbitalRadiusAU: 1, orbitalPeriodDays: 365.25,
                info: "La Tierra es el tercer planeta desde el Sol y el único objeto astronómico conocido por albergar vida. Aproximadamente el 29% de su superficie es tierra firme, mientras que el 71% restante está cubierto de agua. La atmósfera terrestre protege la vida de la radiación solar dañina.",
                moonsData: [
                    { name: "Luna", displaySizeFactor: 0.8, color: "#D3D3D3", moonOrbitFactor: 2.5, orbitalPeriodDays: 27.3, info: "La Luna es el único satélite natural de la Tierra. Es el quinto satélite más grande del Sistema Solar y el más grande en relación con el tamaño de su planeta. Su presencia estabiliza la inclinación axial de la Tierra y produce las mareas." }
                ]
            },
            {
                name: "Marte", type: "planet", displaySizeFactor: 0.7, color: "#FF6347",
                orbitalRadiusAU: 1.52, orbitalPeriodDays: 687,
                info: "Marte es el cuarto planeta desde el Sol y el segundo más pequeño del Sistema Solar. A menudo se le llama el 'Planeta Rojo' debido a la prevalencia de óxido de hierro en su superficie. Tiene casquetes polares, volcanes, cañones y un clima estacional.",
                moonsData: [
                    { name: "Fobos", displaySizeFactor: 0.5, color: "#8B4513", moonOrbitFactor: 2, orbitalPeriodDays: 0.319, info: "Fobos es la luna más grande y cercana de Marte. Orbita Marte más rápido de lo que Marte rota, por lo que sale por el oeste y se pone por el este." },
                    { name: "Deimos", displaySizeFactor: 0.4, color: "#A0522D", moonOrbitFactor: 3, orbitalPeriodDays: 1.26, info: "Deimos es la luna más pequeña y externa de Marte. Tiene una superficie mucho más lisa que Fobos, cubierta de una gruesa capa de regolito." }
                ]
            },
            {
                name: "Júpiter", type: "planet", displaySizeFactor: 3.5, color: "#FFDEAD",
                orbitalRadiusAU: 5.2, orbitalPeriodDays: 4333,
                info: "Júpiter es el quinto planeta desde el Sol y el más grande del Sistema Solar. Es un gigante gaseoso cuya masa es más de dos veces y media la de todos los demás planetas juntos. Es conocido por su Gran Mancha Roja, una tormenta anticiclónica persistente.",
                moonsData: [
                    { name: "Ío", displaySizeFactor: 0.7, color: "#FFFFE0", moonOrbitFactor: 2.0, orbitalPeriodDays: 1.77, info: "Ío es la luna más interna de las cuatro lunas galileanas de Júpiter. Es el objeto geológicamente más activo del Sistema Solar, con más de 400 volcanes activos." },
                    { name: "Europa", displaySizeFactor: 0.65, color: "#ADD8E6", moonOrbitFactor: 2.5, orbitalPeriodDays: 3.55, info: "Europa es la más pequeña de las cuatro lunas galileanas. Se cree que tiene un océano de agua líquida debajo de su superficie helada, lo que la convierte en un candidato para albergar vida extraterrestre." },
                    { name: "Ganimedes", displaySizeFactor: 0.9, color: "#D2B48C", moonOrbitFactor: 3.0, orbitalPeriodDays: 7.15, info: "Ganimedes es la luna más grande de Júpiter y del Sistema Solar, incluso más grande que el planeta Mercurio. Es la única luna conocida que tiene su propio campo magnético." },
                    { name: "Calisto", displaySizeFactor: 0.85, color: "#A9A9A9", moonOrbitFactor: 3.8, orbitalPeriodDays: 16.69, info: "Calisto es la segunda luna más grande de Júpiter y la tercera más grande del Sistema Solar. Su superficie es la más antigua y más craterizada del Sistema Solar." }
                ]
            },
            {
                name: "Saturno", type: "planet", displaySizeFactor: 3, color: "#F0E68C",
                orbitalRadiusAU: 9.58, orbitalPeriodDays: 10759,
                info: "Saturno es el sexto planeta desde el Sol y el segundo más grande. Es un gigante gaseoso conocido por su extenso sistema de anillos, compuesto principalmente de partículas de hielo con una menor cantidad de escombros rocosos y polvo.",
                moonsData: [
                    { name: "Titán", displaySizeFactor: 0.8, color: "#FFA500", moonOrbitFactor: 2.5, orbitalPeriodDays: 15.95, info: "Titán es la luna más grande de Saturno y la segunda más grande del Sistema Solar. Es la única luna conocida con una atmósfera densa y el único objeto además de la Tierra donde se ha encontrado evidencia clara de cuerpos líquidos estables en la superficie." },
                    { name: "Encélado", displaySizeFactor: 0.5, color: "#F5F5F5", moonOrbitFactor: 3.0, orbitalPeriodDays: 1.37, info: "Encélado es una luna helada de Saturno conocida por sus géiseres que expulsan vapor de agua y partículas de hielo desde su polo sur, lo que sugiere un océano subsuperficial." },
                    { name: "Mimas", displaySizeFactor: 0.4, color: "#DCDCDC", moonOrbitFactor: 2.2, orbitalPeriodDays: 0.94, info: "Mimas es una luna de Saturno conocida por su enorme cráter de impacto, Herschel, que le da una apariencia similar a la Estrella de la Muerte de Star Wars." }
                ]
            },
            {
                name: "Urano", type: "planet", displaySizeFactor: 2, color: "#AFEEEE",
                orbitalRadiusAU: 19.22, orbitalPeriodDays: 30689,
                info: "Urano es el séptimo planeta desde el Sol. Tiene la tercera atmósfera planetaria más fría del Sistema Solar. Es único entre los planetas porque su eje de rotación está inclinado lateralmente, casi en su plano orbital.",
                moonsData: [
                    { name: "Miranda", displaySizeFactor: 0.5, color: "#E0FFFF", moonOrbitFactor: 2.5, orbitalPeriodDays: 1.41, info: "Miranda es la más pequeña y más interna de las cinco lunas redondas principales de Urano. Su superficie es un mosaico caótico de terrenos variados, lo que sugiere una historia geológica compleja." },
                    { name: "Titania", displaySizeFactor: 0.6, color: "#F0FFFF", moonOrbitFactor: 3.5, orbitalPeriodDays: 8.71, info: "Titania es la luna más grande de Urano y la octava más grande del Sistema Solar. Su superficie está cubierta de numerosos cráteres y cañones."}
                ]
            },
            {
                name: "Neptuno", type: "planet", displaySizeFactor: 1.9, color: "#4682B4",
                orbitalRadiusAU: 30.1, orbitalPeriodDays: 60182,
                info: "Neptuno es el octavo y más distante planeta conocido del Sol. Es un gigante helado con los vientos más fuertes del Sistema Solar. Tiene un sistema de anillos tenues y oscuros.",
                moonsData: [
                    { name: "Tritón", displaySizeFactor: 0.7, color: "#B0E0E6", moonOrbitFactor: 3, orbitalPeriodDays: 5.88, info: "Tritón es la luna más grande de Neptuno y la única luna grande del Sistema Solar con una órbita retrógrada (orbita en dirección opuesta a la rotación de su planeta). Es uno de los objetos más fríos del Sistema Solar." }
                ]
            }
        ];

        // --- CelestialBody Class ---
        class CelestialBody {
            constructor(name, type, displaySizeFactor, color, primaryOrbitMetric, orbitalPeriodDays, parent = null, info = "Información no disponible.", moonsData = []) {
                this.name = name;
                this.type = type;
                this.color = color;
                this.primaryOrbitMetric = primaryOrbitMetric; 
                this.orbitalPeriodDays = orbitalPeriodDays;
                this.parent = parent;
                this.info = info;
                this.moonsData = moonsData; 
                this.moons = []; 

                this.baseDisplayRadius = this.calculateBaseDisplayRadius(type, displaySizeFactor);
                this.displayRadius = this.baseDisplayRadius;

                this.angle = Math.random() * 2 * Math.PI; 
                this.baseAngularSpeed = this.calculateAngularSpeed();
                this.currentAngularSpeed = this.baseAngularSpeed;

                this.x = 0; this.y = 0;

                this.initMoons();
            }

            calculateBaseDisplayRadius(type, factor) {
                if (type === "star") return STAR_BASE_DISPLAY_RADIUS * factor;
                if (type === "planet") return PLANET_BASE_DISPLAY_RADIUS * factor;
                if (type === "moon") return MOON_BASE_DISPLAY_RADIUS * factor;
                return 5;
            }

            calculateAngularSpeed() {
                if (this.type === 'moon') {
                    return 0;
                }
                if (!this.orbitalPeriodDays || this.orbitalPeriodDays === 0) return 0;
                return (2 * Math.PI / this.orbitalPeriodDays) * REAL_DAYS_PER_ANIM_SECOND_AT_1X * SPEED_MULTIPLIER;
            }

            initMoons() {
                this.moons = this.moonsData.map(moonData =>
                    new CelestialBody(
                        moonData.name, "moon", moonData.displaySizeFactor, moonData.color,
                        moonData.moonOrbitFactor, 
                        moonData.orbitalPeriodDays, this, moonData.info, [] 
                    )
                );
            }

            getScaledOrbitalRadius() {
                if (this.type === 'moon' && this.parent) {
                    return this.parent.displayRadius * this.primaryOrbitMetric;
                } else if (this.type === 'planet') {
                    return this.primaryOrbitMetric * effectivePixelsPerAU;
                }
                return 0; 
            }

            update(deltaTimeSeconds, parentX, parentY) {
                if (this.currentAngularSpeed !== 0) {
                    this.angle += this.currentAngularSpeed * deltaTimeSeconds;
                    this.angle %= (2 * Math.PI);
                }
                
                const scaledOrbitalRadius = this.getScaledOrbitalRadius();
                this.x = parentX + scaledOrbitalRadius * Math.cos(this.angle);
                this.y = parentY + scaledOrbitalRadius * Math.sin(this.angle);

                this.moons.forEach(moon => moon.update(deltaTimeSeconds, this.x, this.y));
            }

            draw(ctx) {
                if (this.parent) { 
                    ctx.beginPath();
                    ctx.strokeStyle = "rgba(100, 100, 120, 0.3)";
                    ctx.lineWidth = 0.5;
                    const orbitCenterX = this.parent.x;
                    const orbitCenterY = this.parent.y;
                    const scaledOrbitalRadius = this.getScaledOrbitalRadius();
                    ctx.ellipse(orbitCenterX, orbitCenterY, scaledOrbitalRadius, scaledOrbitalRadius, 0, 0, 2 * Math.PI);
                    ctx.stroke();
                }

                ctx.beginPath();
                ctx.arc(this.x, this.y, this.displayRadius, 0, 2 * Math.PI);
                ctx.fillStyle = this.color;
                ctx.fill();

                if (hoveredObject === this) {
                    ctx.strokeStyle = "rgba(255, 255, 255, 0.8)";
                    ctx.lineWidth = 2;
                    ctx.stroke();
                }

                ctx.fillStyle = "rgba(220, 220, 255, 0.9)";
                ctx.font = `${Math.max(8, this.displayRadius * 0.5 + 4)}px Inter`;
                ctx.textAlign = "left";
                ctx.fillText(this.name, this.x + this.displayRadius + 5, this.y + this.displayRadius / 2);

                this.moons.forEach(moon => moon.draw(ctx));
            }

            isMouseOver(mouseX, mouseY) {
                const dx = mouseX - this.x;
                const dy = mouseY - this.y;
                return (dx * dx + dy * dy) < (this.displayRadius * 1.2 * this.displayRadius * 1.2);
            }
        }

        // --- Setup and Initialization ---
        function setupCanvas() {
            canvasWidth = window.innerWidth;
            canvasHeight = window.innerHeight;
            canvas.width = canvasWidth;
            canvas.height = canvasHeight;
            centerX = canvasWidth / 2;
            centerY = canvasHeight / 2;

            let maxAU = 0;
            celestialData.forEach(p => {
                if (p.type === 'planet' && p.orbitalRadiusAU > maxAU) maxAU = p.orbitalRadiusAU;
            });
            if (maxAU === 0) maxAU = 1; 
            const minScreenDim = Math.min(canvasWidth, canvasHeight);

            // Standard scaling to fit the outermost planet
            let scaleToFitOuterSystem = (minScreenDim * 0.45) / maxAU;

            // Ensure Mercury is outside the Sun's visual radius
            const mercuryPlanetData = celestialData.find(p => p.name === "Mercurio");
            const mercuryOrbitalAU = mercuryPlanetData ? mercuryPlanetData.orbitalRadiusAU : 0.39; // Default to 0.39 if not found
            const mercuryRadiusPx = PLANET_BASE_DISPLAY_RADIUS * (mercuryPlanetData ? mercuryPlanetData.displaySizeFactor : 0.5);
            
            // Calculate minimum pixel distance for Mercury's orbit from Sun's center
            const minOrbitalRadiusForMercuryPx = STAR_BASE_DISPLAY_RADIUS + mercuryRadiusPx + 10; // Sun's radius + Mercury's radius + 10px buffer
            
            // Calculate minimum scale (px/AU) needed for this visibility
            let minScaleForMercuryVisibility = mercuryOrbitalAU > 0 ? (minOrbitalRadiusForMercuryPx / mercuryOrbitalAU) : scaleToFitOuterSystem;

            // Use the larger of the two scales to ensure Mercury is visible,
            // this might push outer planets further off-screen.
            effectivePixelsPerAU = Math.max(scaleToFitOuterSystem, minScaleForMercuryVisibility);
        }

        function initSolarSystem() {
            solarSystemObjects = celestialData.map(data =>
                new CelestialBody(
                    data.name, data.type, data.displaySizeFactor, data.color,
                    data.orbitalRadiusAU, 
                    data.orbitalPeriodDays,
                    null, 
                    data.info, data.moonsData
                )
            );
            const sun = solarSystemObjects.find(obj => obj.type === 'star');
            if (sun) {
                solarSystemObjects.forEach(obj => {
                    if (obj.type === 'planet') {
                        obj.parent = sun; 
                    }
                });
            }
        }

        // --- Animation Loop ---
        function animate(currentTime) {
            const deltaTime = (currentTime - lastTime) / 1000;
            lastTime = currentTime;

            ctx.clearRect(0, 0, canvasWidth, canvasHeight);

            solarSystemObjects.forEach(obj => {
                if (obj.type === 'star') {
                    obj.x = centerX; 
                    obj.y = centerY;
                    obj.update(deltaTime, centerX, centerY);
                } else if (obj.parent && obj.parent.type === 'star') { 
                    obj.update(deltaTime, obj.parent.x, obj.parent.y);
                }
            });

            solarSystemObjects.forEach(obj => {
                obj.draw(ctx);
            });
            
            requestAnimationFrame(animate);
        }

        // --- Event Handlers ---
        function handleMouseMove(event) {
            const rect = canvas.getBoundingClientRect();
            const mouseX = event.clientX - rect.left;
            const mouseY = event.clientY - rect.top;

            let newHoveredCandidate = null;

            // Pass 1: Check all moons first (topmost layer)
            for (const systemObj of solarSystemObjects) {
                if (systemObj.type === 'planet') {
                    for (const moon of systemObj.moons) {
                        if (moon.isMouseOver(mouseX, mouseY)) {
                            newHoveredCandidate = moon;
                            break; // Found a moon, it's the highest priority
                        }
                    }
                }
                if (newHoveredCandidate) break; // If a moon was found, stop checking other planets for their moons
            }

            // Pass 2: If no moon hovered, check all planets
            if (!newHoveredCandidate) {
                for (const systemObj of solarSystemObjects) {
                    if (systemObj.type === 'planet') {
                        if (systemObj.isMouseOver(mouseX, mouseY)) {
                            newHoveredCandidate = systemObj;
                            break; // Found a planet
                        }
                    }
                }
            }

            // Pass 3: If no planet or moon hovered, check the Sun
            if (!newHoveredCandidate) {
                const sun = solarSystemObjects.find(obj => obj.type === 'star');
                if (sun && sun.isMouseOver(mouseX, mouseY)) {
                    newHoveredCandidate = sun;
                }
            }
            
            // Apply hover effects (zoom, slowdown)
            if (newHoveredCandidate !== hoveredObject) {
                if (hoveredObject) { 
                    if (originalSpeeds.has(hoveredObject) && hoveredObject.type !== 'moon') {
                         hoveredObject.currentAngularSpeed = originalSpeeds.get(hoveredObject);
                    } else if (hoveredObject.type !== 'moon') {
                        hoveredObject.currentAngularSpeed = hoveredObject.baseAngularSpeed;
                    }
                    hoveredObject.displayRadius = originalRadii.get(hoveredObject) || hoveredObject.baseDisplayRadius;
                    originalSpeeds.delete(hoveredObject);
                    originalRadii.delete(hoveredObject);
                }
                if (newHoveredCandidate) { 
                    if (newHoveredCandidate.type !== 'moon') { 
                        originalSpeeds.set(newHoveredCandidate, newHoveredCandidate.currentAngularSpeed);
                        newHoveredCandidate.currentAngularSpeed /= HOVER_SLOWDOWN_FACTOR;
                    }
                    originalRadii.set(newHoveredCandidate, newHoveredCandidate.displayRadius);
                    newHoveredCandidate.displayRadius *= HOVER_ZOOM_FACTOR;
                }
                hoveredObject = newHoveredCandidate;
            }
            canvas.style.cursor = hoveredObject ? 'pointer' : 'default';
        }

        function handleClick(event) {
            if (hoveredObject) {
                showInfoPanel(hoveredObject);
            }
        }

        // --- Info Panel Logic ---
        function showInfoPanel(object) {
            infoName.textContent = object.name;
            infoText.textContent = object.info;
            infoMoonsList.innerHTML = ''; 

            if (object.type === 'planet' && object.moons.length > 0) {
                infoMoonsContainer.style.display = 'block';
                object.moons.forEach(moon => {
                    const li = document.createElement('li');
                    li.textContent = moon.name;
                    li.onclick = (e) => {
                        e.stopPropagation(); 
                        showInfoPanel(moon); 
                    };
                    infoMoonsList.appendChild(li);
                });
            } else {
                infoMoonsContainer.style.display = 'none';
            }
            infoPanelContainer.classList.add('visible');
        }

        function hideInfoPanel() {
            infoPanelContainer.classList.remove('visible');
        }

        // --- Event Listeners ---
        window.addEventListener('DOMContentLoaded', () => {
            setupCanvas();
            initSolarSystem();
            lastTime = performance.now(); 
            requestAnimationFrame(animate);
        });
        window.addEventListener('resize', () => {
            clearTimeout(window.resizeTimeout);
            window.resizeTimeout = setTimeout(() => {
                 setupCanvas();
            }, 250);
        });
        canvas.addEventListener('mousemove', handleMouseMove);
        canvas.addEventListener('click', handleClick);
        closeButton.addEventListener('click', hideInfoPanel);
        infoPanelContainer.addEventListener('click', (e) => { 
            if (e.target === infoPanelContainer) {
                hideInfoPanel();
            }
        });

        if (document.readyState === 'complete' || document.readyState === 'interactive') {
            if (!lastTime && solarSystemObjects.length === 0) { 
                 setupCanvas();
                 initSolarSystem();
                 lastTime = performance.now();
                 requestAnimationFrame(animate);
            }
        }
    </script>
</body>
</html>

